# 權值股監控
## 針對市值排名前30大之個股漲跌幅視覺化，挖掘今日強勢大型股


```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import mplfinance
import tejapi
import plotly.graph_objects as go
import requests as rq
from bs4 import BeautifulSoup
import json
from plotly.offline import plot, iplot, init_notebook_mode
import plotly.graph_objs as go
import pandas_datareader as web
from datetime import datetime
import calendar
```


```python
# 蒐集股票代碼 #
# 自證交所 https://www.twse.com.tw/zh/page/trading/fund/T86.html下載 2019/01/02 的成交資訊 #
nextlink = 'https://www.twse.com.tw/fund/T86?response=excel&date=20190102&selectType=ALLBUT0999'
nl_response = rq.get(nextlink, verify=False) # 用 requests 的 get 方法把網頁抓下來
soup = BeautifulSoup(nl_response.text, "html.parser") # 指定 作為解析器
a = json.loads(soup.text)
stock = pd.DataFrame(a.get('data'),columns=a.get('fields'))
stock['date'] = a.get('date')
```

    C:\Users\KUAN\anaconda3\envs\tensorflow-gpu\lib\site-packages\urllib3\connectionpool.py:986: InsecureRequestWarning:
    
    Unverified HTTPS request is being made to host 'www.twse.com.tw'. Adding certificate verification is strongly advised. See: https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warnings
    
    


```python
# 輸入 TEJ_API 密碼
tejapi.ApiConfig.api_key = "dPIRXEEUZMUS7mFaoScvGcmrcgh2x3"
# 設定欲觀察之股票(上市全體股票)
stock_id = []
for i in stock['證券代號']:
    if len(i) > 4:
        pass
    else:
        stock_id.append(i)
# 設定觀察期間
trial_date = ['2019-01-02','2019-01-03']
# 透過 TEJ_API撈取資料
ret_data = tejapi.get('TRAIL/TAPRCD', coid = stock_id, mdate = {'gte':trial_date[0],'lte':trial_date[1]}
                  ,opts={'columns':['coid','mdate','open_d','high_d','low_d','close_d','roib','volume','mv']}, paginate=True)
```


```python
#修改欄位名稱
ret_data.rename(columns={'roib':'日報酬',
                         'volume':'成交量',
                         'mv':'市值'},inplace=True)
```


```python
# 將資料分成昨天與今天
yesterday = ret_data[ret_data['mdate']==trial_date[0]]
today = ret_data[ret_data['mdate']==trial_date[1]]
yesterday.index = range(0,len(yesterday))
today.index = range(0,len(today))
```


```python
# 對昨天的資料欄位進行更改，以利後續合併欄位索引使用
yesterday.rename(columns={'open_d':'open_y',
                         'high_d':'high_y',
                         'low_d':'low_y',
                         'close_d':'close_y'},inplace=True)
# 針對相同證券代號者進行合併
today = pd.merge(today,yesterday[['coid','close_y']],on='coid')
```

    C:\Users\KUAN\anaconda3\envs\tensorflow-gpu\lib\site-packages\pandas\core\frame.py:4133: SettingWithCopyWarning:
    
    
    A value is trying to be set on a copy of a slice from a DataFrame
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
    
    


```python
# 根據昨日收盤價計算出今日 K棒的位置(以百分比顯示)
today['open_r'] = (today['open_d'] - today['close_y'])/today['close_y']*100
today['high_r'] = (today['high_d'] - today['close_y'])/today['close_y']*100
today['low_r'] = (today['low_d'] - today['close_y'])/today['close_y']*100
today['close_r'] = (today['close_d'] - today['close_y'])/today['close_y']*100
```


```python
today
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coid</th>
      <th>mdate</th>
      <th>open_d</th>
      <th>high_d</th>
      <th>low_d</th>
      <th>close_d</th>
      <th>日報酬</th>
      <th>成交量</th>
      <th>市值</th>
      <th>close_y</th>
      <th>open_r</th>
      <th>high_r</th>
      <th>low_r</th>
      <th>close_r</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0050</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>73.80</td>
      <td>74.00</td>
      <td>73.25</td>
      <td>73.35</td>
      <td>-0.9498</td>
      <td>13347.147</td>
      <td>69462</td>
      <td>74.05</td>
      <td>-0.337610</td>
      <td>-0.067522</td>
      <td>-1.080351</td>
      <td>-0.945307</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0051</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>28.11</td>
      <td>28.11</td>
      <td>28.01</td>
      <td>28.02</td>
      <td>-0.3207</td>
      <td>22.515</td>
      <td>280</td>
      <td>28.11</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-0.355745</td>
      <td>-0.320171</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0052</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>46.80</td>
      <td>46.80</td>
      <td>46.80</td>
      <td>46.80</td>
      <td>-1.6950</td>
      <td>101.000</td>
      <td>538</td>
      <td>47.60</td>
      <td>-1.680672</td>
      <td>-1.680672</td>
      <td>-1.680672</td>
      <td>-1.680672</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0053</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>29.86</td>
      <td>30.09</td>
      <td>29.66</td>
      <td>30.03</td>
      <td>-1.6513</td>
      <td>6.000</td>
      <td>209</td>
      <td>30.53</td>
      <td>-2.194563</td>
      <td>-1.441205</td>
      <td>-2.849656</td>
      <td>-1.637733</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0054</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>19.23</td>
      <td>19.25</td>
      <td>19.19</td>
      <td>19.25</td>
      <td>-0.7246</td>
      <td>5.000</td>
      <td>214</td>
      <td>19.39</td>
      <td>-0.825168</td>
      <td>-0.722022</td>
      <td>-1.031460</td>
      <td>-0.722022</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>785</th>
      <td>9943</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>58.00</td>
      <td>58.00</td>
      <td>57.70</td>
      <td>57.70</td>
      <td>-0.5186</td>
      <td>87.264</td>
      <td>8500</td>
      <td>58.00</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-0.517241</td>
      <td>-0.517241</td>
    </tr>
    <tr>
      <th>786</th>
      <td>9945</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>44.80</td>
      <td>45.65</td>
      <td>44.50</td>
      <td>45.00</td>
      <td>1.3423</td>
      <td>1518.050</td>
      <td>45146</td>
      <td>44.40</td>
      <td>0.900901</td>
      <td>2.815315</td>
      <td>0.225225</td>
      <td>1.351351</td>
    </tr>
    <tr>
      <th>787</th>
      <td>9946</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>12.45</td>
      <td>12.50</td>
      <td>12.40</td>
      <td>12.50</td>
      <td>0.0000</td>
      <td>49.900</td>
      <td>3514</td>
      <td>12.50</td>
      <td>-0.400000</td>
      <td>0.000000</td>
      <td>-0.800000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>788</th>
      <td>9955</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>12.35</td>
      <td>12.35</td>
      <td>12.00</td>
      <td>12.25</td>
      <td>0.8197</td>
      <td>54.038</td>
      <td>1264</td>
      <td>12.15</td>
      <td>1.646091</td>
      <td>1.646091</td>
      <td>-1.234568</td>
      <td>0.823045</td>
    </tr>
    <tr>
      <th>789</th>
      <td>9958</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>57.80</td>
      <td>59.90</td>
      <td>56.80</td>
      <td>58.30</td>
      <td>-4.6910</td>
      <td>8159.482</td>
      <td>12168</td>
      <td>61.10</td>
      <td>-5.400982</td>
      <td>-1.963993</td>
      <td>-7.037643</td>
      <td>-4.582651</td>
    </tr>
  </tbody>
</table>
<p>790 rows × 14 columns</p>
</div>




```python
# 挑選出市值前 30名之個股，用以觀察今日行情概況
MV_30 = today.sort_values('市值',ascending=False)[:30]
MV_30.index = range(0,len(MV_30))
# 加入股票名稱
MV_30['stock_name'] = str(0)
for name in MV_30.coid:
    MV_30['stock_name'][MV_30.coid == name] = stock['證券名稱'][name == stock['證券代號']].values
MV_30
```

    C:\Users\KUAN\anaconda3\envs\tensorflow-gpu\lib\site-packages\ipykernel_launcher.py:7: SettingWithCopyWarning:
    
    
    A value is trying to be set on a copy of a slice from a DataFrame
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
    
    




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coid</th>
      <th>mdate</th>
      <th>open_d</th>
      <th>high_d</th>
      <th>low_d</th>
      <th>close_d</th>
      <th>日報酬</th>
      <th>成交量</th>
      <th>市值</th>
      <th>close_y</th>
      <th>open_r</th>
      <th>high_r</th>
      <th>low_r</th>
      <th>close_r</th>
      <th>stock_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2330</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>214.00</td>
      <td>218.00</td>
      <td>214.00</td>
      <td>215.50</td>
      <td>-1.8391</td>
      <td>34615.620</td>
      <td>5587996</td>
      <td>219.50</td>
      <td>-2.505695</td>
      <td>-0.683371</td>
      <td>-2.505695</td>
      <td>-1.822323</td>
      <td>台積電</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6505</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>103.00</td>
      <td>104.50</td>
      <td>101.50</td>
      <td>104.00</td>
      <td>0.9662</td>
      <td>2457.616</td>
      <td>990699</td>
      <td>103.00</td>
      <td>0.000000</td>
      <td>1.456311</td>
      <td>-1.456311</td>
      <td>0.970874</td>
      <td>台塑化</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2317</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>69.00</td>
      <td>69.40</td>
      <td>68.50</td>
      <td>68.90</td>
      <td>-1.7267</td>
      <td>36659.461</td>
      <td>955160</td>
      <td>70.10</td>
      <td>-1.569187</td>
      <td>-0.998573</td>
      <td>-2.282454</td>
      <td>-1.711840</td>
      <td>鴻海</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2412</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>107.50</td>
      <td>107.50</td>
      <td>107.00</td>
      <td>107.00</td>
      <td>0.0000</td>
      <td>5508.818</td>
      <td>830046</td>
      <td>107.00</td>
      <td>0.467290</td>
      <td>0.467290</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>中華電</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1301</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>97.60</td>
      <td>97.90</td>
      <td>96.00</td>
      <td>96.00</td>
      <td>-1.6529</td>
      <td>6817.026</td>
      <td>611111</td>
      <td>97.60</td>
      <td>0.000000</td>
      <td>0.307377</td>
      <td>-1.639344</td>
      <td>-1.639344</td>
      <td>台塑</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1326</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>99.60</td>
      <td>101.00</td>
      <td>99.10</td>
      <td>100.00</td>
      <td>0.3005</td>
      <td>3736.079</td>
      <td>586118</td>
      <td>99.70</td>
      <td>-0.100301</td>
      <td>1.303912</td>
      <td>-0.601805</td>
      <td>0.300903</td>
      <td>台化</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1303</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>73.00</td>
      <td>73.90</td>
      <td>72.90</td>
      <td>73.30</td>
      <td>0.4101</td>
      <td>3580.598</td>
      <td>581329</td>
      <td>73.00</td>
      <td>0.000000</td>
      <td>1.232877</td>
      <td>-0.136986</td>
      <td>0.410959</td>
      <td>南亞</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2882</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>45.80</td>
      <td>45.85</td>
      <td>45.15</td>
      <td>45.15</td>
      <td>-1.6475</td>
      <td>17509.748</td>
      <td>567228</td>
      <td>45.90</td>
      <td>-0.217865</td>
      <td>-0.108932</td>
      <td>-1.633987</td>
      <td>-1.633987</td>
      <td>國泰金</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2881</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>46.10</td>
      <td>46.25</td>
      <td>45.70</td>
      <td>45.80</td>
      <td>-0.6529</td>
      <td>7585.046</td>
      <td>468699</td>
      <td>46.10</td>
      <td>0.000000</td>
      <td>0.325380</td>
      <td>-0.867679</td>
      <td>-0.650759</td>
      <td>富邦金</td>
    </tr>
    <tr>
      <th>9</th>
      <td>3008</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>3000.00</td>
      <td>3050.00</td>
      <td>2960.00</td>
      <td>3030.00</td>
      <td>-0.9852</td>
      <td>1122.574</td>
      <td>406444</td>
      <td>3060.00</td>
      <td>-1.960784</td>
      <td>-0.326797</td>
      <td>-3.267974</td>
      <td>-0.980392</td>
      <td>大立光</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2891</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>20.00</td>
      <td>20.05</td>
      <td>19.90</td>
      <td>20.00</td>
      <td>0.5013</td>
      <td>19330.631</td>
      <td>389939</td>
      <td>19.90</td>
      <td>0.502513</td>
      <td>0.753769</td>
      <td>0.000000</td>
      <td>0.502513</td>
      <td>中信金</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1216</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>67.50</td>
      <td>68.50</td>
      <td>67.30</td>
      <td>67.50</td>
      <td>-1.1782</td>
      <td>6736.068</td>
      <td>383536</td>
      <td>68.30</td>
      <td>-1.171303</td>
      <td>0.292826</td>
      <td>-1.464129</td>
      <td>-1.171303</td>
      <td>統一</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2002</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>24.20</td>
      <td>24.20</td>
      <td>23.95</td>
      <td>24.15</td>
      <td>0.6231</td>
      <td>8798.772</td>
      <td>379996</td>
      <td>24.00</td>
      <td>0.833333</td>
      <td>0.833333</td>
      <td>-0.208333</td>
      <td>0.625000</td>
      <td>中鋼</td>
    </tr>
    <tr>
      <th>13</th>
      <td>3045</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>107.00</td>
      <td>107.00</td>
      <td>106.00</td>
      <td>106.50</td>
      <td>-0.4684</td>
      <td>2647.126</td>
      <td>364638</td>
      <td>107.00</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-0.934579</td>
      <td>-0.467290</td>
      <td>台灣大</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2454</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>224.00</td>
      <td>226.00</td>
      <td>221.00</td>
      <td>223.50</td>
      <td>1.3514</td>
      <td>3718.829</td>
      <td>355701</td>
      <td>220.50</td>
      <td>1.587302</td>
      <td>2.494331</td>
      <td>0.226757</td>
      <td>1.360544</td>
      <td>聯發科</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2886</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>25.30</td>
      <td>25.50</td>
      <td>25.20</td>
      <td>25.45</td>
      <td>0.0000</td>
      <td>12343.811</td>
      <td>346115</td>
      <td>25.45</td>
      <td>-0.589391</td>
      <td>0.196464</td>
      <td>-0.982318</td>
      <td>0.000000</td>
      <td>兆豐金</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2308</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>126.50</td>
      <td>130.00</td>
      <td>126.00</td>
      <td>130.00</td>
      <td>2.3347</td>
      <td>4493.915</td>
      <td>337680</td>
      <td>127.00</td>
      <td>-0.393701</td>
      <td>2.362205</td>
      <td>-0.787402</td>
      <td>2.362205</td>
      <td>台達電</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2912</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>300.00</td>
      <td>303.50</td>
      <td>296.50</td>
      <td>299.50</td>
      <td>-0.3333</td>
      <td>1289.566</td>
      <td>311366</td>
      <td>300.50</td>
      <td>-0.166389</td>
      <td>0.998336</td>
      <td>-1.331115</td>
      <td>-0.332779</td>
      <td>統一超</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2892</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>19.80</td>
      <td>19.90</td>
      <td>19.80</td>
      <td>19.90</td>
      <td>0.5038</td>
      <td>6231.173</td>
      <td>245537</td>
      <td>19.80</td>
      <td>0.000000</td>
      <td>0.505051</td>
      <td>0.000000</td>
      <td>0.505051</td>
      <td>第一金</td>
    </tr>
    <tr>
      <th>19</th>
      <td>3711</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>54.80</td>
      <td>56.60</td>
      <td>54.00</td>
      <td>56.00</td>
      <td>-0.8889</td>
      <td>14270.437</td>
      <td>242011</td>
      <td>56.50</td>
      <td>-3.008850</td>
      <td>0.176991</td>
      <td>-4.424779</td>
      <td>-0.884956</td>
      <td>日月光投控</td>
    </tr>
    <tr>
      <th>20</th>
      <td>4904</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>72.90</td>
      <td>72.90</td>
      <td>72.10</td>
      <td>72.30</td>
      <td>-0.1382</td>
      <td>1741.330</td>
      <td>235589</td>
      <td>72.40</td>
      <td>0.690608</td>
      <td>0.690608</td>
      <td>-0.414365</td>
      <td>-0.138122</td>
      <td>遠傳</td>
    </tr>
    <tr>
      <th>21</th>
      <td>5880</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>17.70</td>
      <td>17.70</td>
      <td>17.55</td>
      <td>17.70</td>
      <td>0.5666</td>
      <td>5983.526</td>
      <td>222467</td>
      <td>17.60</td>
      <td>0.568182</td>
      <td>0.568182</td>
      <td>-0.284091</td>
      <td>0.568182</td>
      <td>合庫金</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2884</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>20.10</td>
      <td>20.25</td>
      <td>20.10</td>
      <td>20.10</td>
      <td>0.0000</td>
      <td>9248.924</td>
      <td>217660</td>
      <td>20.10</td>
      <td>0.000000</td>
      <td>0.746269</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>玉山金</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2382</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>52.30</td>
      <td>52.70</td>
      <td>51.80</td>
      <td>52.50</td>
      <td>0.7648</td>
      <td>4913.571</td>
      <td>202787</td>
      <td>52.10</td>
      <td>0.383877</td>
      <td>1.151631</td>
      <td>-0.575816</td>
      <td>0.767754</td>
      <td>廣達</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2880</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>17.45</td>
      <td>17.50</td>
      <td>17.35</td>
      <td>17.50</td>
      <td>0.5731</td>
      <td>5043.375</td>
      <td>202013</td>
      <td>17.40</td>
      <td>0.287356</td>
      <td>0.574713</td>
      <td>-0.287356</td>
      <td>0.574713</td>
      <td>華南金</td>
    </tr>
    <tr>
      <th>25</th>
      <td>1101</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>35.50</td>
      <td>35.60</td>
      <td>35.10</td>
      <td>35.15</td>
      <td>-0.9908</td>
      <td>9160.859</td>
      <td>179548</td>
      <td>35.50</td>
      <td>0.000000</td>
      <td>0.281690</td>
      <td>-1.126761</td>
      <td>-0.985915</td>
      <td>台泥</td>
    </tr>
    <tr>
      <th>26</th>
      <td>2885</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>15.15</td>
      <td>15.20</td>
      <td>15.05</td>
      <td>15.10</td>
      <td>-0.6601</td>
      <td>13691.028</td>
      <td>176462</td>
      <td>15.20</td>
      <td>-0.328947</td>
      <td>0.000000</td>
      <td>-0.986842</td>
      <td>-0.657895</td>
      <td>元大金</td>
    </tr>
    <tr>
      <th>27</th>
      <td>2633</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>30.05</td>
      <td>30.30</td>
      <td>29.85</td>
      <td>30.20</td>
      <td>0.0000</td>
      <td>5321.204</td>
      <td>169974</td>
      <td>30.20</td>
      <td>-0.496689</td>
      <td>0.331126</td>
      <td>-1.158940</td>
      <td>0.000000</td>
      <td>台灣高鐵</td>
    </tr>
    <tr>
      <th>28</th>
      <td>2801</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>17.30</td>
      <td>17.35</td>
      <td>17.25</td>
      <td>17.25</td>
      <td>0.0000</td>
      <td>4669.334</td>
      <td>168869</td>
      <td>17.25</td>
      <td>0.289855</td>
      <td>0.579710</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>彰銀</td>
    </tr>
    <tr>
      <th>29</th>
      <td>2474</td>
      <td>2019-01-03 00:00:00+00:00</td>
      <td>221.50</td>
      <td>223.50</td>
      <td>214.00</td>
      <td>215.00</td>
      <td>-5.8708</td>
      <td>6975.875</td>
      <td>165634</td>
      <td>228.00</td>
      <td>-2.850877</td>
      <td>-1.973684</td>
      <td>-6.140351</td>
      <td>-5.701754</td>
      <td>可成</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 繪製權值股當日報酬率變動圖
fig = go.Figure(data=[go.Candlestick(x=MV_30['stock_name'],
                open=MV_30.open_r, high=MV_30.high_r,
                low=MV_30.low_r, close=MV_30.close_r,increasing_line_color = 'red', decreasing_line_color= 'green')])

fig.update_layout(
    title='市值排名前30之大型權值股',
    yaxis_title='return in percentage',
)

fig.show()
```


<div>                            <div id="43aa9b08-ea3a-4e51-a42f-2670a1ed3f0d" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("43aa9b08-ea3a-4e51-a42f-2670a1ed3f0d")) {                    Plotly.newPlot(                        "43aa9b08-ea3a-4e51-a42f-2670a1ed3f0d",                        [{"close": [-1.8223234624145785, 0.9708737864077669, -1.7118402282453478, 0.0, -1.6393442622950762, 0.30090270812437026, 0.4109589041095852, -1.6339869281045754, -0.6507592190889464, -0.9803921568627451, 0.5025125628140775, -1.1713030746705668, 0.624999999999994, -0.46728971962616817, 1.3605442176870748, 0.0, 2.3622047244094486, -0.33277870216306155, 0.5050505050504942, -0.8849557522123894, -0.13812154696133774, 0.568181818181806, 0.0, 0.7677543186180396, 0.5747126436781691, -0.9859154929577505, -0.657894736842103, 0.0, 0.0, -5.701754385964912], "decreasing": {"line": {"color": "green"}}, "high": [-0.683371298405467, 1.4563106796116505, -0.998573466476446, 0.46728971962616817, 0.30737704918033953, 1.303911735205614, 1.232876712328775, -0.10893246187363215, 0.32537960954446543, -0.32679738562091504, 0.7537688442211162, 0.2928257686676469, 0.8333333333333304, 0.0, 2.494331065759637, 0.19646365422397138, 2.3622047244094486, 0.9983361064891847, 0.5050505050504942, 0.1769911504424804, 0.6906077348066298, 0.568181818181806, 0.7462686567164107, 1.151631477927066, 0.5747126436781691, 0.28169014084507443, 0.0, 0.3311258278145743, 0.5797101449275445, -1.9736842105263157], "increasing": {"line": {"color": "red"}}, "low": [-2.5056947608200453, -1.4563106796116505, -2.282453637660477, 0.0, -1.6393442622950762, -0.6018054162487548, -0.13698630136985523, -1.6339869281045754, -0.8676789587852464, -3.2679738562091507, 0.0, -1.4641288433382138, -0.20833333333333628, -0.9345794392523363, 0.22675736961451248, -0.9823182711198428, -0.7874015748031495, -1.3311148086522462, 0.0, -4.424778761061947, -0.4143646408839936, -0.2840909090909131, 0.0, -0.5758157389635399, -0.2873563218390641, -1.1267605633802777, -0.9868421052631486, -1.1589403973509862, 0.0, -6.140350877192982], "open": [-2.5056947608200453, 0.0, -1.5691868758915755, 0.46728971962616817, 0.0, -0.10030090270813291, 0.0, -0.21786492374727978, 0.0, -1.9607843137254901, 0.5025125628140775, -1.1713030746705668, 0.8333333333333304, 0.0, 1.5873015873015872, -0.5893909626719002, -0.39370078740157477, -0.16638935108153077, 0.0, -3.008849557522129, 0.6906077348066298, 0.568181818181806, 0.0, 0.3838771593090129, 0.28735632183908455, 0.0, -0.3289473684210456, -0.4966887417218496, 0.28985507246377223, -2.850877192982456], "type": "candlestick", "x": ["\u53f0\u7a4d\u96fb          ", "\u53f0\u5851\u5316          ", "\u9d3b\u6d77            ", "\u4e2d\u83ef\u96fb          ", "\u53f0\u5851            ", "\u53f0\u5316            ", "\u5357\u4e9e            ", "\u570b\u6cf0\u91d1          ", "\u5bcc\u90a6\u91d1          ", "\u5927\u7acb\u5149          ", "\u4e2d\u4fe1\u91d1          ", "\u7d71\u4e00            ", "\u4e2d\u92fc            ", "\u53f0\u7063\u5927          ", "\u806f\u767c\u79d1          ", "\u5146\u8c50\u91d1          ", "\u53f0\u9054\u96fb          ", "\u7d71\u4e00\u8d85          ", "\u7b2c\u4e00\u91d1          ", "\u65e5\u6708\u5149\u6295\u63a7      ", "\u9060\u50b3            ", "\u5408\u5eab\u91d1          ", "\u7389\u5c71\u91d1          ", "\u5ee3\u9054            ", "\u83ef\u5357\u91d1          ", "\u53f0\u6ce5            ", "\u5143\u5927\u91d1          ", "\u53f0\u7063\u9ad8\u9435        ", "\u5f70\u9280            ", "\u53ef\u6210            "]}],                        {"template": {"data": {"bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "bar"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "barpolar"}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "choropleth": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "choropleth"}], "contour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "contour"}], "contourcarpet": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "contourcarpet"}], "heatmap": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmap"}], "heatmapgl": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmapgl"}], "histogram": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "histogram"}], "histogram2d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2d"}], "histogram2dcontour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2dcontour"}], "mesh3d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "mesh3d"}], "parcoords": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "parcoords"}], "pie": [{"automargin": true, "type": "pie"}], "scatter": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter"}], "scatter3d": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter3d"}], "scattercarpet": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattercarpet"}], "scattergeo": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergeo"}], "scattergl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergl"}], "scattermapbox": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattermapbox"}], "scatterpolar": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolar"}], "scatterpolargl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolargl"}], "scatterternary": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterternary"}], "surface": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "surface"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}]}, "layout": {"annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "autotypenumbers": "strict", "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]], "sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}, "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "geo": {"bgcolor": "white", "lakecolor": "white", "landcolor": "#E5ECF6", "showlakes": true, "showland": true, "subunitcolor": "white"}, "hoverlabel": {"align": "left"}, "hovermode": "closest", "mapbox": {"style": "light"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "ternary": {"aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "title": {"x": 0.05}, "xaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}, "yaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}}}, "title": {"text": "\u5e02\u503c\u6392\u540d\u524d30\u4e4b\u5927\u578b\u6b0a\u503c\u80a1"}, "yaxis": {"title": {"text": "return in percentage"}}},                        {"responsive": true}                    ).then(function(){

var gd = document.getElementById('43aa9b08-ea3a-4e51-a42f-2670a1ed3f0d');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>


# 產業概況監控
## 找出今日強勢產業


```python
# 自TEJ_API撈取產業類別 tejind1_c
ind = tejapi.get('TRAIL/AIND', coid = stock_id
                  ,opts={'columns':['coid','mdate','tejind1_c']}, paginate=True)
ind
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coid</th>
      <th>mdate</th>
      <th>tejind1_c</th>
    </tr>
    <tr>
      <th>None</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1101</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M1100 水泥工業</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1102</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M1100 水泥工業</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1103</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M1100 水泥工業</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1104</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M1100 水泥工業</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1109</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M1100 水泥工業</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>774</th>
      <td>9943</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M2700 觀光事業</td>
    </tr>
    <tr>
      <th>775</th>
      <td>9945</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M9900 其他</td>
    </tr>
    <tr>
      <th>776</th>
      <td>9946</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M2500 建材營造</td>
    </tr>
    <tr>
      <th>777</th>
      <td>9955</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M9900 其他</td>
    </tr>
    <tr>
      <th>778</th>
      <td>9958</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M2000 鋼鐵工業</td>
    </tr>
  </tbody>
</table>
<p>779 rows × 3 columns</p>
</div>




```python
# 將 tejind1_c 欄位中的值對空白進行切割
new = ind.tejind1_c.str.split(' ',n=1,expand=True)
```


```python
# 將中文字部分做為新的欄位 industry_name
ind['industry_name'] = new[1]
ind
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coid</th>
      <th>mdate</th>
      <th>tejind1_c</th>
      <th>industry_name</th>
    </tr>
    <tr>
      <th>None</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1101</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M1100 水泥工業</td>
      <td>水泥工業</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1102</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M1100 水泥工業</td>
      <td>水泥工業</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1103</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M1100 水泥工業</td>
      <td>水泥工業</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1104</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M1100 水泥工業</td>
      <td>水泥工業</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1109</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M1100 水泥工業</td>
      <td>水泥工業</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>774</th>
      <td>9943</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M2700 觀光事業</td>
      <td>觀光事業</td>
    </tr>
    <tr>
      <th>775</th>
      <td>9945</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M9900 其他</td>
      <td>其他</td>
    </tr>
    <tr>
      <th>776</th>
      <td>9946</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M2500 建材營造</td>
      <td>建材營造</td>
    </tr>
    <tr>
      <th>777</th>
      <td>9955</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M9900 其他</td>
      <td>其他</td>
    </tr>
    <tr>
      <th>778</th>
      <td>9958</td>
      <td>2020-01-01 00:00:00+00:00</td>
      <td>M2000 鋼鐵工業</td>
      <td>鋼鐵工業</td>
    </tr>
  </tbody>
</table>
<p>779 rows × 4 columns</p>
</div>




```python
#產業類別個數
ind['industry_name'].unique(), len(ind['industry_name'].unique())
```




    (array(['水泥工業', '食品工業', '其他', '塑膠工業', '建材營造', '汽車工業', '紡織纖維', '貿易百貨',
            '電機機械', '電子工業', '化學生技醫', '電器電纜', '玻璃陶瓷', '造紙工業', '鋼鐵工業', '橡膠工業',
            '航運業', '油電燃', '觀光事業', '金融業', '証券'], dtype=object),
     21)




```python
# 再將產業類別與 today 資料進行合併
ind_today = pd.merge(today,ind[['coid','industry_name']],on='coid')
ind_mv = ind_today.groupby('industry_name').sum().市值
```


```python
# 由於台灣加權指數採用市值加權，故先製作個股在產業所佔之權重 industry_weight
ind_today['industry_weight'] = 0
for industry in ind_mv.index:
    condition = ind_today['industry_name']==industry
    ind_today['industry_weight'][condition] = ind_today['市值'][condition]/ind_mv[industry]
```

    C:\Users\KUAN\anaconda3\envs\tensorflow-gpu\lib\site-packages\ipykernel_launcher.py:5: SettingWithCopyWarning:
    
    
    A value is trying to be set on a copy of a slice from a DataFrame
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
    
    C:\Users\KUAN\anaconda3\envs\tensorflow-gpu\lib\site-packages\ipykernel_launcher.py:5: SettingWithCopyWarning:
    
    
    A value is trying to be set on a copy of a slice from a DataFrame
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
    
    


```python
# 計算個股產業報酬率貢獻
ind_today['weight_avg_return'] = ind_today['日報酬']*ind_today['industry_weight']
```


```python
# 針對各產業的產業貢獻進行加總
ind_today.groupby('industry_name').sum()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>open_d</th>
      <th>high_d</th>
      <th>low_d</th>
      <th>close_d</th>
      <th>日報酬</th>
      <th>成交量</th>
      <th>市值</th>
      <th>close_y</th>
      <th>open_r</th>
      <th>high_r</th>
      <th>low_r</th>
      <th>close_r</th>
      <th>industry_weight</th>
      <th>weight_avg_return</th>
    </tr>
    <tr>
      <th>industry_name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>其他</th>
      <td>3453.69</td>
      <td>3522.92</td>
      <td>3430.91</td>
      <td>3493.58</td>
      <td>22.5245</td>
      <td>27316.794</td>
      <td>1002070</td>
      <td>3460.15</td>
      <td>-6.093395</td>
      <td>67.266162</td>
      <td>-44.939814</td>
      <td>23.367268</td>
      <td>1.0</td>
      <td>1.204213</td>
    </tr>
    <tr>
      <th>化學生技醫</th>
      <td>2971.25</td>
      <td>3015.76</td>
      <td>2935.66</td>
      <td>2957.15</td>
      <td>2.3363</td>
      <td>32848.830</td>
      <td>508163</td>
      <td>2972.72</td>
      <td>-0.637197</td>
      <td>76.994261</td>
      <td>-41.761915</td>
      <td>3.007388</td>
      <td>1.0</td>
      <td>-0.107391</td>
    </tr>
    <tr>
      <th>塑膠工業</th>
      <td>508.34</td>
      <td>511.76</td>
      <td>502.11</td>
      <td>504.44</td>
      <td>-16.5189</td>
      <td>40146.462</td>
      <td>1912503</td>
      <td>508.74</td>
      <td>0.254388</td>
      <td>8.438845</td>
      <td>-22.677987</td>
      <td>-16.356798</td>
      <td>1.0</td>
      <td>-0.401522</td>
    </tr>
    <tr>
      <th>建材營造</th>
      <td>900.53</td>
      <td>909.80</td>
      <td>893.94</td>
      <td>900.60</td>
      <td>3.9808</td>
      <td>20341.043</td>
      <td>399419</td>
      <td>898.08</td>
      <td>7.380755</td>
      <td>41.444962</td>
      <td>-24.810990</td>
      <td>4.174095</td>
      <td>1.0</td>
      <td>0.472689</td>
    </tr>
    <tr>
      <th>橡膠工業</th>
      <td>228.35</td>
      <td>230.40</td>
      <td>226.50</td>
      <td>228.30</td>
      <td>0.8322</td>
      <td>5153.816</td>
      <td>264636</td>
      <td>227.95</td>
      <td>0.832919</td>
      <td>9.871148</td>
      <td>-5.861455</td>
      <td>0.875101</td>
      <td>1.0</td>
      <td>0.912003</td>
    </tr>
    <tr>
      <th>水泥工業</th>
      <td>132.35</td>
      <td>132.95</td>
      <td>130.85</td>
      <td>131.40</td>
      <td>-3.4763</td>
      <td>13333.056</td>
      <td>330370</td>
      <td>132.10</td>
      <td>1.078708</td>
      <td>4.171613</td>
      <td>-6.192601</td>
      <td>-3.441380</td>
      <td>1.0</td>
      <td>-0.510171</td>
    </tr>
    <tr>
      <th>汽車工業</th>
      <td>1774.49</td>
      <td>1791.30</td>
      <td>1754.84</td>
      <td>1771.24</td>
      <td>-12.7067</td>
      <td>6324.481</td>
      <td>445689</td>
      <td>1774.04</td>
      <td>0.434747</td>
      <td>19.437351</td>
      <td>-29.623846</td>
      <td>-12.451732</td>
      <td>1.0</td>
      <td>0.213784</td>
    </tr>
    <tr>
      <th>油電燃</th>
      <td>259.35</td>
      <td>261.05</td>
      <td>256.75</td>
      <td>259.90</td>
      <td>1.3844</td>
      <td>2933.863</td>
      <td>1037568</td>
      <td>258.85</td>
      <td>1.844646</td>
      <td>3.901557</td>
      <td>-3.148543</td>
      <td>1.395386</td>
      <td>1.0</td>
      <td>0.925399</td>
    </tr>
    <tr>
      <th>玻璃陶瓷</th>
      <td>67.43</td>
      <td>67.62</td>
      <td>66.90</td>
      <td>67.40</td>
      <td>-0.6577</td>
      <td>873.511</td>
      <td>45285</td>
      <td>67.44</td>
      <td>-0.710761</td>
      <td>1.011715</td>
      <td>-3.420883</td>
      <td>-0.654265</td>
      <td>1.0</td>
      <td>0.265133</td>
    </tr>
    <tr>
      <th>紡織纖維</th>
      <td>1088.09</td>
      <td>1098.87</td>
      <td>1074.44</td>
      <td>1088.90</td>
      <td>-11.1613</td>
      <td>23827.845</td>
      <td>480868</td>
      <td>1089.31</td>
      <td>-0.200143</td>
      <td>20.268811</td>
      <td>-33.963456</td>
      <td>-10.960176</td>
      <td>1.0</td>
      <td>0.112837</td>
    </tr>
    <tr>
      <th>航運業</th>
      <td>409.21</td>
      <td>411.95</td>
      <td>406.41</td>
      <td>408.15</td>
      <td>-6.0148</td>
      <td>33096.842</td>
      <td>562659</td>
      <td>409.47</td>
      <td>-1.390709</td>
      <td>12.458657</td>
      <td>-15.092392</td>
      <td>-5.942410</td>
      <td>1.0</td>
      <td>-0.237540</td>
    </tr>
    <tr>
      <th>觀光事業</th>
      <td>644.74</td>
      <td>648.34</td>
      <td>634.23</td>
      <td>636.75</td>
      <td>-10.3575</td>
      <td>2955.113</td>
      <td>99575</td>
      <td>645.42</td>
      <td>1.104798</td>
      <td>5.547515</td>
      <td>-13.829932</td>
      <td>-10.200380</td>
      <td>1.0</td>
      <td>-1.465883</td>
    </tr>
    <tr>
      <th>証券</th>
      <td>66.66</td>
      <td>69.02</td>
      <td>66.60</td>
      <td>68.26</td>
      <td>5.0433</td>
      <td>2823.214</td>
      <td>45825</td>
      <td>66.60</td>
      <td>0.674157</td>
      <td>7.163484</td>
      <td>0.000000</td>
      <td>5.102466</td>
      <td>1.0</td>
      <td>1.329894</td>
    </tr>
    <tr>
      <th>貿易百貨</th>
      <td>968.44</td>
      <td>974.17</td>
      <td>952.59</td>
      <td>959.00</td>
      <td>-4.9280</td>
      <td>9767.254</td>
      <td>483329</td>
      <td>959.99</td>
      <td>5.549844</td>
      <td>16.859390</td>
      <td>-17.022592</td>
      <td>-4.851494</td>
      <td>1.0</td>
      <td>-0.317557</td>
    </tr>
    <tr>
      <th>造紙工業</th>
      <td>85.95</td>
      <td>86.77</td>
      <td>85.43</td>
      <td>86.07</td>
      <td>-0.6343</td>
      <td>5457.630</td>
      <td>75587</td>
      <td>86.05</td>
      <td>-0.889098</td>
      <td>4.524427</td>
      <td>-4.462345</td>
      <td>-0.590976</td>
      <td>1.0</td>
      <td>-0.250770</td>
    </tr>
    <tr>
      <th>金融業</th>
      <td>593.78</td>
      <td>596.13</td>
      <td>589.88</td>
      <td>592.30</td>
      <td>-1.3817</td>
      <td>257964.570</td>
      <td>4136275</td>
      <td>593.27</td>
      <td>4.264873</td>
      <td>16.512256</td>
      <td>-14.905049</td>
      <td>-1.278197</td>
      <td>1.0</td>
      <td>-0.248174</td>
    </tr>
    <tr>
      <th>鋼鐵工業</th>
      <td>543.45</td>
      <td>549.53</td>
      <td>538.39</td>
      <td>543.79</td>
      <td>-12.1548</td>
      <td>37782.887</td>
      <td>612438</td>
      <td>547.79</td>
      <td>-10.164876</td>
      <td>8.709352</td>
      <td>-28.144425</td>
      <td>-11.922531</td>
      <td>1.0</td>
      <td>0.305938</td>
    </tr>
    <tr>
      <th>電器電纜</th>
      <td>89.74</td>
      <td>90.06</td>
      <td>89.01</td>
      <td>89.34</td>
      <td>-4.7488</td>
      <td>8881.290</td>
      <td>82142</td>
      <td>89.84</td>
      <td>-0.849456</td>
      <td>1.558386</td>
      <td>-7.654070</td>
      <td>-4.723580</td>
      <td>1.0</td>
      <td>-0.638351</td>
    </tr>
    <tr>
      <th>電子工業</th>
      <td>19905.23</td>
      <td>20162.85</td>
      <td>19550.59</td>
      <td>19783.69</td>
      <td>-268.3583</td>
      <td>987368.225</td>
      <td>14562287</td>
      <td>20021.35</td>
      <td>-30.845280</td>
      <td>375.484452</td>
      <td>-549.061439</td>
      <td>-260.389636</td>
      <td>1.0</td>
      <td>-1.198255</td>
    </tr>
    <tr>
      <th>電機機械</th>
      <td>1813.07</td>
      <td>1832.62</td>
      <td>1786.70</td>
      <td>1807.21</td>
      <td>-7.2594</td>
      <td>46381.299</td>
      <td>405454</td>
      <td>1821.37</td>
      <td>-6.259971</td>
      <td>31.711993</td>
      <td>-43.056555</td>
      <td>-6.577747</td>
      <td>1.0</td>
      <td>-1.078639</td>
    </tr>
    <tr>
      <th>食品工業</th>
      <td>682.50</td>
      <td>686.68</td>
      <td>676.14</td>
      <td>678.28</td>
      <td>-3.2301</td>
      <td>18853.430</td>
      <td>574626</td>
      <td>680.56</td>
      <td>4.783739</td>
      <td>15.403623</td>
      <td>-9.978629</td>
      <td>-3.160647</td>
      <td>1.0</td>
      <td>-0.745675</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 將資料依加權平均漲跌幅進行排序
ind_sorted = ind_today.groupby('industry_name').sum().sort_values('weight_avg_return',ascending=False)
```


```python
# 各產業走勢
plt.figure(figsize=(10,5)) # 調整圖片大小
plt.rcParams['font.sans-serif'] = ['Microsoft JhengHei'] # 將橫軸字體調成中文
plt.rcParams['axes.unicode_minus']=False
# 若遇到中文無法顯示的問題 ：
# https://medium.com/marketingdatascience/%E8%A7%A3%E6%B1%BApython-3-matplotlib%E8%88%87seaborn%E8%A6%96%E8%A6%BA%E5%8C%96%E5%A5%97%E4%BB%B6%E4%B8%AD%E6%96%87%E9%A1%AF%E7%A4%BA%E5%95%8F%E9%A1%8C-f7b3773a889b
plt.xticks(rotation = 270) # X軸的字體旋轉270度
plt.xticks(fontsize=20) # 調整 X軸字體大小
plt.yticks(fontsize=15) # 調整 Y軸字體大小
plt.bar(x=ind_sorted.index,height =ind_sorted['weight_avg_return'])
```




    <BarContainer object of 21 artists>




![png](output_21_1.png)

